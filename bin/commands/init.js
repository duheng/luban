"use strict";require("shelljs/global");const e=require("fs"),t=require("path"),c=require("ora"),{askCurrentDir:i,askProductName:r,askReplayDir:s,selectTmpl:o}=require("../utils/prompt"),l=process.cwd(),n=t.join(__dirname,"..","..",".tmpl"),a=c({text:"",spinner:{interval:100,frames:["ğŸšš","ğŸ”—","ğŸ”","ğŸ“ƒ"]}}),p=e=>{const t=`https://github.com/duheng/tmpl_${e}.git -b master`;console.log("æ¨¡ç‰ˆä»“åº“åœ°å€:",t),which("git")||(echo("æ£€æµ‹åˆ°æ‚¨è¿˜æ²¡æœ‰å®‰è£…gitï¼Œè¯·å…ˆå®‰è£…git"),exit(1)),exec("git config http.sslVerify false"),exec("git config https.sslVerify false"),echo(`ğŸ”— æ¨¡ç‰ˆ ${e} ä¸‹è½½ä¸­...\r`),0!==exec(`git clone ${t}`).code&&(echo("Error: Git clone failed"),exit(1)),a.succeed(`æ¨¡ç‰ˆ ${e} å·²ä¸‹è½½\r`)},d=c=>{!e.existsSync(n)&&mkdir("-p",n);const i=t.join(n,`tmpl_${c}`);e.existsSync(i)?(cd(i),(e=>{echo(`æ£€æµ‹æ¨¡ç‰ˆ ${e} çš„å˜æ›´...\r`),which("git")||(a.fail("æ£€æµ‹åˆ°æ‚¨è¿˜æ²¡æœ‰å®‰è£…gitï¼Œè¯·å…ˆå®‰è£…git"),exit(1)),0!==exec("git pull").code&&(a.info("è¿œç¨‹æ¨¡ç‰ˆæœ‰æ›´æ–°,æ­£åœ¨é‡æ–°ä¸‹è½½"),cd(".."),rm("-rf",`tmpl_${e}`),p(e)),a.succeed(`æ¨¡ç‰ˆ ${e} å·²æ›´æ–°\r`)})(c)):(cd(n),p(c))};module.exports=async t=>{const c=await r()||"",i=`${l}/${c}`,p=e.existsSync(i);if(p&&c){if(!await s(c))return void console.log("å¥½çš„ï¼Œè¯·é‡æ–°åˆ›å»ºå¹¶è®¾ç½®ä¸€ä¸ªé¡¹ç›®åç§°")}const u=await o();a.start(),d(u);const g=`${n}/tmpl_${u}/*`;try{!p&&mkdir("-p",i),cp("-Rf",g,i),a.succeed(`é¡¹ç›® ${c} å·²åˆ›å»º\r`),h=i,echo("ğŸ” å®‰è£…ä¾èµ–åŒ…...\r"),cd(h),exec("npm install"),a.succeed(`è¯·æ‰§è¡Œ: cd ${c} && luban server \r`)}catch(e){a.fail(`é¡¹ç›® ${c} å·²åˆ›å»ºå¤±è´¥\r\n${e}`)}var h;a.stop()};
