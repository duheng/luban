"use strict";require("shelljs/global");const e=require("fs"),t=require("path"),c=require("ora"),{askCurrentDir:i,askProductName:r,askReplayDir:s,selectTmpl:o}=require("../utils/prompt"),l=process.cwd(),n=t.join(__dirname,"..","..",".tmpl"),a=c({text:"",spinner:{interval:100,frames:["🚚","🔗","🔍","📃"]}}),p=e=>{const t=`https://github.com/duheng/tmpl_${e}.git -b master`;console.log("模版仓库地址:",t),which("git")||(echo("检测到您还没有安装git，请先安装git"),exit(1)),exec("git config http.sslVerify false"),exec("git config https.sslVerify false"),echo(`🔗 模版 ${e} 下载中...\r`),0!==exec(`git clone ${t}`).code&&(echo("Error: Git clone failed"),exit(1)),a.succeed(`模版 ${e} 已下载\r`)},d=c=>{!e.existsSync(n)&&mkdir("-p",n);const i=t.join(n,`tmpl_${c}`);e.existsSync(i)?(cd(i),(e=>{echo(`检测模版 ${e} 的变更...\r`),which("git")||(a.fail("检测到您还没有安装git，请先安装git"),exit(1)),0!==exec("git pull").code&&(a.info("远程模版有更新,正在重新下载"),cd(".."),rm("-rf",`tmpl_${e}`),p(e)),a.succeed(`模版 ${e} 已更新\r`)})(c)):(cd(n),p(c))};module.exports=async t=>{const c=await r()||"",i=`${l}/${c}`,p=e.existsSync(i);if(p&&c){if(!await s(c))return void console.log("好的，请重新创建并设置一个项目名称")}const u=await o();a.start(),d(u);const g=`${n}/tmpl_${u}/*`;try{!p&&mkdir("-p",i),cp("-Rf",g,i),a.succeed(`项目 ${c} 已创建\r`),h=i,echo("🔍 安装依赖包...\r"),cd(h),exec("npm install"),a.succeed(`请执行: cd ${c} && luban server \r`)}catch(e){a.fail(`项目 ${c} 已创建失败\r\n${e}`)}var h;a.stop()};
