"use strict";require("shelljs/global");const e=require("fs"),r=require("path"),o=process.cwd(),{config:s}=require("../utils/common"),{getWebpackConfig:n}=require("../utils/webpackConfig"),l=require("webpack");module.exports=async i=>{let c=null;if(i.node)process.env.NODE_ENV="development",c=n("server");else{try{e.existsSync(r.join(o,s.build,s.dll))||await require("./dll")(i)}catch(e){console.log("打包dll失败：",e)}i.prod?(process.env.NODE_ENV="production",c=n("production")):(process.env.NODE_ENV="development",c=n("development"))}await(e=>new Promise(((r,o)=>{l({...e},((e,o)=>{if(e)return console.error(e.stack||e),void(e.details&&console.error(e.details));const s=o.toJson();o.hasErrors()&&console.error(s.errors),o.hasWarnings()&&console.warn(s.warnings),r()}))})))(c)};
