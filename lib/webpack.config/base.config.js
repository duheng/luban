"use strict";const e=require("webpack"),s=require("terser-webpack-plugin"),r=require("copy-webpack-plugin");require("clean-webpack-plugin");const n=require("add-asset-html-webpack-plugin"),t=require("vue-loader/lib/plugin"),i=require("../plugins/format-progress-plugin"),{useDllPath:l}=require("../utils/common"),o=require("fs"),u=require("path"),a=process.cwd(),{entry:c,dllReferencePlugin:p,loadDllAssets:m,genAlias:d}=require("../utils/common"),g=require("./rules"),v=s=>{let a=[new e.ProgressPlugin(i),new e.optimize.ModuleConcatenationPlugin];"react"==s.platform?a.push(new e.ProvidePlugin({React:"react"})):"vue"==s.platform&&a.push(new t),s.library&&Object.keys(s.library).length>0&&o.existsSync(l())&&(a.push(...p(s)),a.push(new n(m(s))));const c=u.resolve(s.base,s.assets||"assets");return o.existsSync(c)&&o.statSync(c).isDirectory()&&a.push(new r({patterns:[{from:c,to:s.assets||"assets"}]})),a},w=e=>{let s={...d(u.join(a,e.base),e)};return"vue"==e.platform&&(s.vue$="vue/dist/vue.esm.js"),s};module.exports=e=>({context:u.join(a),entry:c,externals:e.externals||{},module:g(e),cache:!1,resolve:{modules:[a,u.resolve(__dirname,"..","..","node_modules"),"node_modules"],alias:w(e),extensions:[".js",".jsx",".tsx",".scss",".css",".vue",".json",".less",".ts"]},resolveLoader:{modules:[u.resolve(__dirname,"..","..","node_modules")]},plugins:v(e),optimization:{chunkIds:"deterministic",minimize:!1,minimizer:["production"===process.env.NODE_ENV?new s({exclude:/\/node_modules/,parallel:!0,extractComments:!1,terserOptions:{}}):null].filter(Boolean)}});
