"use strict";const e=require("webpack"),s=require("terser-webpack-plugin"),n=require("copy-webpack-plugin"),{CleanWebpackPlugin:r}=require("clean-webpack-plugin"),i=require("add-asset-html-webpack-plugin");require("../utils/buildCache");const l=require("vue-loader/lib/plugin"),t=require("../plugins/format-progress-plugin"),o=require("fs"),u=require("path"),a=process.cwd(),{entry:c,dllReferencePlugin:p,loadDllAssets:d,genAlias:m}=require("../utils/common"),g=require("./rules"),v=s=>{let c=[new e.ProgressPlugin(t),new r({verbose:!1,cleanOnceBeforeBuildPatterns:["**/*","!dll","!dll/**/*"]}),new e.IgnorePlugin({resourceRegExp:/^\.\/locale$/,contextRegExp:/moment$/}),new e.DefinePlugin({"process.env":{NODE_ENV:JSON.stringify(process.env.NODE_ENV)},API:JSON.stringify(s.api[process.env.NODE_ENV]),STATIC:JSON.stringify(s.static[process.env.NODE_ENV])}),new e.ProvidePlugin({React:"react"}),new l,new e.optimize.ModuleConcatenationPlugin];s.library&&Object.keys(s.library).length>0&&o.existsSync(u.join(a,s.build,s.dll))&&(c.push(...p(s)),c.push(new i(d(s))));const m=u.resolve(s.base,s.assets||"assets");return o.existsSync(m)&&o.statSync(m).isDirectory()&&c.push(new n({patterns:[{from:m,to:s.assets||"assets"}]})),c};module.exports=e=>({context:u.join(a),entry:c,externals:e.externals||{},module:g(e),resolve:{modules:[a,u.resolve(__dirname,"..","..","node_modules"),"node_modules","bower_components"],alias:{vue$:"vue/dist/vue.esm.js",...m(u.join(a,e.base),e)},extensions:[".js",".jsx",".scss",".css",".vue",".json",".less",".ts",".tsx"]},resolveLoader:{modules:[u.resolve(__dirname,"..","..","node_modules")]},plugins:v(e),optimization:{runtimeChunk:{name:"runtime"},splitChunks:{minSize:1,maxAsyncRequests:1e5,maxInitialRequests:1e5,cacheGroups:{default:!1,vendors:!1}},moduleIds:"named",minimize:!1,minimizer:["production"===process.env.NODE_ENV?new s({include:/\/node_modules/,parallel:!0,extractComments:!0,terserOptions:{}}):null].filter(Boolean)}});
