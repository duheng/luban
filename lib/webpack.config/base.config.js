"use strict";const e=require("webpack"),s=require("terser-webpack-plugin"),n=require("copy-webpack-plugin");require("clean-webpack-plugin");const r=require("add-asset-html-webpack-plugin"),i=require("vue-loader/lib/plugin"),t=require("../plugins/format-progress-plugin"),{useDllPath:o}=require("../utils/common"),u=require("fs"),l=require("path"),a=process.cwd(),{entry:m,dllReferencePlugin:c,loadDllAssets:p,genAlias:d}=require("../utils/common"),g=require("./rules"),h=s=>{let a=[new e.ProgressPlugin(t),new e.IgnorePlugin({resourceRegExp:/^\.\/locale$/,contextRegExp:/moment$/}),new e.optimize.ModuleConcatenationPlugin];"react"==s.platform?a.push(new e.ProvidePlugin({React:"react"})):"vue"==s.platform&&a.push(new i),s.library&&Object.keys(s.library).length>0&&u.existsSync(o())&&(a.push(...c(s)),a.push(new r(p(s))));const m=l.resolve(s.base,s.assets||"assets");return u.existsSync(m)&&u.statSync(m).isDirectory()&&a.push(new n({patterns:[{from:m,to:s.assets||"assets"}]})),a},x=e=>{let s={...d(l.join(a,e.base),e)};return"vue"==e.platform&&(s.vue$="vue/dist/vue.esm.js"),s};module.exports=e=>({context:l.join(a),entry:m,externals:e.externals||{},module:g(e),cache:!1,resolve:{modules:[a,l.resolve(__dirname,"..","..","node_modules"),"node_modules"],alias:x(e),extensions:[".js",".jsx",".tsx",".scss",".css",".vue",".json",".less",".ts"]},resolveLoader:{modules:[l.resolve(__dirname,"..","..","node_modules")]},plugins:h(e),optimization:{splitChunks:{chunks:"all",minSize:8e4,minRemainingSize:0,maxSize:0,minChunks:4,maxAsyncRequests:6,maxInitialRequests:4,automaticNameDelimiter:"~",name:"chunk",hidePathInfo:!0,cacheGroups:{common:{name:"chunk-common",minChunks:3,priority:0,reuseExistingChunk:!0}}},chunkIds:"deterministic",minimize:!1,minimizer:["production"===process.env.NODE_ENV?new s({exclude:/\/node_modules/,parallel:!0,extractComments:!1,terserOptions:{}}):null].filter(Boolean)}});
