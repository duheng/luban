"use strict";const e=require("webpack"),s=require("terser-webpack-plugin"),r=require("copy-webpack-plugin"),{CleanWebpackPlugin:n}=require("clean-webpack-plugin"),l=require("add-asset-html-webpack-plugin"),o=require("vue-loader/lib/plugin"),i=require("../plugins/format-progress-plugin"),{useDllPath:t}=require("../utils/common"),u=require("fs"),a=require("path"),c=process.cwd(),{entry:p,dllReferencePlugin:d,loadDllAssets:m,genAlias:g}=require("../utils/common"),w=require("./rules"),b=s=>{let c=[new e.ProgressPlugin(i),new n({verbose:!1,cleanOnceBeforeBuildPatterns:["**/*","!dll","!dll/**/*"]}),new e.IgnorePlugin({resourceRegExp:/^\.\/locale$/,contextRegExp:/moment$/}),new e.ProvidePlugin({React:"react"}),new o,new e.optimize.ModuleConcatenationPlugin];s.library&&Object.keys(s.library).length>0&&u.existsSync(t())&&(c.push(...d(s)),c.push(new l(m(s))));const p=a.resolve(s.base,s.assets||"assets");return u.existsSync(p)&&u.statSync(p).isDirectory()&&c.push(new r({patterns:[{from:p,to:s.assets||"assets"}]})),c};module.exports=e=>({context:a.join(c),entry:p,externals:e.externals||{},module:w(e),resolve:{modules:[c,a.resolve(__dirname,"..","..","node_modules"),"node_modules","bower_components"],alias:{vue$:"vue/dist/vue.esm.js",...g(a.join(c,e.base),e)},extensions:[".js",".jsx",".scss",".css",".vue",".json",".less",".ts",".tsx"]},resolveLoader:{modules:[a.resolve(__dirname,"..","..","node_modules")]},plugins:b(e),optimization:{chunkIds:"named",minimize:!1,minimizer:["production"===process.env.NODE_ENV?new s({exclude:/\/node_modules/,parallel:!0,extractComments:!0,terserOptions:{}}):null].filter(Boolean)}});
