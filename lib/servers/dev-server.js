"use strict";const e=require("path"),r=require("fs"),{createProxyMiddleware:t}=require("http-proxy-middleware"),o=require("webpack"),n=require("../webpack.config/development.client.config")(),a=require("express"),i=require("connect-history-api-fallback"),s=a(),l=(t=>{let o={...t},n=o.entry,a={};if("object"!=typeof n)throw new Error('entryå¿…é¡»objectç±»å‹\n ä¾‹å¦‚ï¼š"entry": {"main":"./src/pages/index.js"}\r\n');for(let t in n){if(Array.isArray(n[t]))throw new Error('entryå¿…é¡»objectç±»å‹\n ä¾‹å¦‚ï¼š"entry": {"main":"./src/pages/index.js"}\r\n');try{const o=String(r.readFileSync(e.resolve(n[t])));/\bmodule.hot\b/.test(o)||(console.log("\nç³»ç»Ÿæ£€æµ‹åˆ°å…¥å£æ–‡ä»¶ç¼ºå°‘çƒ­æ›´æ–°å¿…é¡»çš„module.hotï¼Œç³»ç»Ÿå·²ä¸ºæ‚¨è‡ªåŠ¨æ·»åŠ \n"),r.appendFileSync(e.resolve(n[t]),";if (module.hot) {module.hot.accept()}; "))}catch(e){throw`å…¥å£æ–‡ä»¶åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥å…¥å£æ–‡ä»¶\r\n${e}`}a[t]=[n[t],"webpack-hot-middleware/client?reload=false&path=/__webpack_hmr&timeout=20000"]}return o.entry=a,o})(n),c=o(l);module.exports=e=>{console.log();const r=require("webpack-dev-middleware")(c);s.use(r),s.use(i()),r.waitUntilValid((()=>{s.use(require("webpack-hot-middleware")(c)),console.log(),(e=>{const r=e.proxy;r&&r.length>0&&(console.log(`[luban] å·²ä¸ºæ‚¨åˆå§‹åŒ–ä»¥ä¸‹ ${r.length} ä¸ªä»£ç† \n`),r.map((e=>{console.log(`${e.path} -> ${e.target}/${e.path}\n`),s.use(e.path,t({target:e.target,changeOrigin:!1,logs:!1}))})))})(e),s.listen(e.port,(()=>{console.log(`ğŸŒ start service at http://${e.host}:${e.port}\n`)})),process.on("uncaughtException",(e=>{if(!(e&&e.toString().indexOf("address already in use")>-1))throw e;{const r=/address already in use [^\d]+(\d+)/.exec(e)[1];logger.error(r+" ç«¯å£å·²è¢«å ç”¨ï¼Œè¯·åœ¨luban.js ä¸­æ›´æ¢ç«¯å£")}}))}))};
