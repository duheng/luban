"use strict";const e=require("webpack"),t=require("path"),r=require("fs"),n=process.cwd(),{printLog:s,getUtilName:i}=require("./base"),c=()=>{const e=i(),t=require(`${n}/${e}.js`);if(Object.keys(t).length>0)return t;s({type:"error",text:`没有加载到配置文件${e}.*`})},l=c(),o=()=>t.join(n,l.dll);module.exports={webpackCommand:(()=>{const e=t.resolve(__dirname,"..","..","node_modules",".bin","webpack");return r.existsSync(e)?e:"webpack"})(),config:c(),entry:(()=>{if("object"!=typeof l.entry)return s({type:"error",text:'entry必须object类型\n 例如："entry": {"main":"./src/pages/index.js"}\r\n'});if(Object.keys(l.entry).length>0)return l.entry;{const e=t.join(n,l.base,l.pages);try{if(!r.existsSync(e))return s({type:"error",text:"请设置项目配置文件入口entry字段"}),{}}catch(e){return s({type:"error",text:"请设置项目配置文件入口entry字段"}),{}}const i=r.readdirSync(e);let c={};for(let n=0;n<i.length;n++){const s=t.join(e,i[n]);r.statSync(s).isDirectory()&&(c[i[n]]=`./${l.base}/${l.pages}/${i[n]}/index.js`)}return c}})(),dllReferencePlugin:i=>Object.keys(i.library).map((i=>{const c=((e,t)=>{try{if(!r.existsSync(e))return!1}catch(e){return!1}const n=r.readdirSync(e);for(let e=0;e<n.length;e++)if(new RegExp(t).test(n[e]))return n[e];return!1})(o(),`${i}[^.]*\\.manifest\\.json`);return c?new e.DllReferencePlugin({context:t.join(n),manifest:require(t.join(o(),c))}):(s({type:"error",text:`没有找到${i}对应的dll manifest.json 文件`}),null)})),loadDllAssets:e=>r.readdirSync(o()).filter((e=>e.match(/.js$/))).map((r=>({filepath:t.join(o(),r),outputPath:"dll",publicPath:`${e.static[process.env.NODE_ENV]}/dll`}))),genAlias:(e,s)=>{const i=r.readdirSync(e),c=s.alias;let l={};return i.forEach((r=>{l[r]=t.resolve(e,r)})),c&&"object"==typeof c&&Object.keys(c).forEach((e=>{l[e]=t.join(n,c[e])})),"vue"==s.platform&&(l.vue$="vue/dist/vue.esm.js"),{...l}},getTemplate:e=>{const i=Object.keys(l.template).filter((t=>t==e)),c=i.length>0&&t.join(n,l.template[i[0]]),o=c||t.join(n,"template.html");let a="";return r.existsSync(o)?a=r.readFileSync(o,"utf8"):(s({text:"没有在您的项目中加载到模版文件，将使用默认模版"}),a=r.readFileSync(t.join(__dirname,"..","config","template.html"),"utf8")),a},useDllPath:o};
