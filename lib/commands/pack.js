"use strict";require("shelljs/global"),require("fs"),require("path"),process.cwd();const{config:e,useDllPath:r}=require("../utils/common"),{changeCache:o,setCacheVersion:s}=require("../utils/clearCache"),{isChangeDll:t}=require("../utils/dllPitch"),{getWebpackConfig:i}=require("../utils/webpackConfig"),{printLog:n}=require("../utils/base"),l=require("webpack");module.exports=async c=>{let a=null;if(c.node)process.env.NODE_ENV="development",a=i("server");else{try{const o=r();t(o,e)&&await require("./dll")(c)}catch(e){console.log("打包dll失败：",e)}c.dev?(process.env.NODE_ENV="development",a=i("development")):(process.env.NODE_ENV="production",a=i("production"))}c.min&&(a.optimization.minimize=!0),o(process.env.NODE_ENV),await(e=>{const r=Date.now();return new Promise(((o,s)=>{n({text:"Build Project..."}),l({...e},((e,s)=>{if(e)return console.error(e.stack||e),void(e.details&&console.error(e.details));const t=s.toJson();s.hasErrors()&&console.error(t.errors),s.hasWarnings()&&console.warn(t.warnings);const i=parseInt((Date.now()-r)/1e3);n({text:"Build Project Complete."}),n({text:`Build Time. ${i}s`}),o()}))}))})(a),s(process.env.NODE_ENV)};
