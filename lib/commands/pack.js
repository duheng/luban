"use strict";require("shelljs/global"),require("fs"),require("path"),process.cwd();const{config:e,useDllPath:r}=require("../utils/common"),{isChangeDll:o}=require("../utils/dllPitch"),{getWebpackConfig:s}=require("../utils/webpackConfig"),{printLog:l}=require("../utils/printLog"),i=require("webpack");module.exports=async n=>{let t=null;if(n.node)process.env.NODE_ENV="development",t=s("server");else{try{const s=r();o(s,e)&&await require("./dll")(n)}catch(e){console.log("打包dll失败：",e)}n.prod?(process.env.NODE_ENV="production",t=s("production")):(process.env.NODE_ENV="development",t=s("development"))}await(e=>new Promise(((r,o)=>{l("Building project"),i({...e},((e,o)=>{if(e)return console.error(e.stack||e),void(e.details&&console.error(e.details));const s=o.toJson();o.hasErrors()&&console.error(s.errors),o.hasWarnings()&&console.warn(s.warnings),l("Build project complete"),r()}))})))(t)};
